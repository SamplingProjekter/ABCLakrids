---
title: "ABCLakrids"
author: "Smilk"
date: "13 sep 2018"
output: pdf_document
fig_caption: yes
---
## Introduktion til data og metode
Simon har samplet 4 poser ABC lakrids fra Haribo fra en Kvickly (her kan man overveje samplemetoden).
Poserne er samplet ud af af en population vi kan kalde ABC lakridser produceret til Danmark, hvor populationen ($N$) formodes at være meget stor, hvorved vi må antage at 1/N og $n/N$ er $0$, hvilket også betyder at vores estimat for populationstotalen vil være uendelig. 
I stikprøven har vi oberveret hvilke bogstaver hver enhed har. Således er interessevariablen en indikatorfunktion som kan tage 29 værdier.
Vi har dog måttet sande at vi ikke har observeret ø eller å og at det er umuligt at skeldne mellem M og W og Z og N, da det ikke fremgår klart hvordan de respektive bogstaver bør se ud. 
For at gøre dette så neutralt som mulig, og stadig gøre det muligt at lave beregninger, har vi valgt at antage, bogstaver som kan kategoriseres som to værdier fordeles til halv halv, og at de bogstaver som ikke er observeret ikke forekommer i totalpopulationen. 
Hver pose betragtes som en sample, af størrelse n (stokastisk værdi afhænger af vægten, da antallet af bogstaver varierer i hver pose). Det gennemsnitlige antal bogstaver pr pose er 80 (mere præcist $79.75$ men vi kan ikke observere halve bogstaver) 

## Overvejelser og problematikker med stikprøven.
Det er en række forskellige eventuelle problemer med vores stikprøve, som vi er nød til at behandle inden vi laver beregninger på data. Som nævnt ovenfor kender vi ikke vores populationsstørrelse $N$, da vi ikke ved hvor mange ABC lakridser der blevet produceret og solgt i Danmark som vi ville have haft mulighed for at købe. Derfor har vi valgt at betragte en uendelig, men dog deterministisk, populationsstørrelse. 
En anden problematik er, at der er nogle bogstaver vi ikke kan kende forskel på, samt nogle bogstaver som vi slet ikke har samplet. Som nævnt ovenfor har vi derfor arbejdet med et alfabet med 27 bogstaver (uden ø og å). Problemstillingen med ikke at kunne se forskel på nogen bogstaver (f.eks N og Z) løste vi ved at tælle halvdelen af dem som N'er og halvdelen som Z'er. Vi mener at dette er den bedste løsning, selvom det muligvis kan introducere bias i vores stikprøve. 
Man kan også overveje om det er unbiased alle fire poser er samplet fra samme butik på samme tidspunkt. I stedet burde man have samplet ved SRS med tilbagelægning hvilke 4 butiker i Danmark hvor poserne skulle købes, da vi jo a priori ikke ved om det kunne skabe en bias i vores sample inden vi laver eksperimentet. 

## Overvejelser sammenlignet med alfabetet.
```{R, echo=FALSE, fig.width=10, fig.height=3.5, fig.cap="\\label{fig:figs} Bogstaver samplet fra de forskellige poser. Hver farvet bar indikerer en pose. Den sorte linje (L. Mean) viser gennemsnittet for hver bogstav over de 4 poser, mens den røde linje angiver gennemsnittet over alle bogstaver på tværs af poser"}
# Read data
Dat <- as.matrix(read.table("Data.R", sep="",head=TRUE,fill = TRUE))
#Formate data as matrix
Dat_new <- na.omit(matrix(as.numeric(Dat[,-1]),ncol=4,nrow=29))
rownames(Dat_new) <- Dat[-c(28,29),1]

# Sample size
n <- colSums(Dat_new)
n_mean <- sum(Dat_new)/4

# Plot data
mean <- apply(Dat_new,1,mean)
df <- barplot(t(Dat_new),beside=TRUE,col = rainbow(4))
lines(df,rep(mean,each=4),lty=2,lwd=1)
lines(df,rep(mean(mean),each=length(df)),lty=2,col="red")
legend("topleft",c("L. Mean","T. Mean"),lty = 2,col=c("black","red"))
```

Hvis vi ønsker at skrive et bestemt ord, kræver det ofte (i alt fald på dansk) at vi har en rimmelig mængde af vokaler til rådighed. Lad derfor $y_v(i)$ betegne indikatorfunktionen for at individ $i$ er en en vokal.
Fra dette finder vi (jvf Corollary 2.13) at $\bar y$ inden for hver pose er den empiriske varians 0.0025 0.0024 0.0025 og 0.0025 for hhv. pose 1, 2, 3 og 4. med konfidens interval for hver af de givne poser som følgende.
```{R}
id <- ifelse(rownames(Dat_new)%in% c("A","E","I",
                                    "O","U","Y",
                                    "AE"), TRUE,FALSE)
y_bar <- colSums(Dat_new[id,])/n
var_emp <- (1-0)*y_bar*(1-y_bar)/(n-1)
sqrt(var_emp) #Standard afvigelse

uu <- qnorm(.975)
CI <- cbind(y_bar-uu*sqrt(var_emp),y_bar+uu*sqrt(var_emp))
round(CI,2)
```


Til sammenligning forventer vi at det danske alphabet med 27 bogstaver (ink. W ekls. ø og å) og 7 vokaler har en forekomst af vokaler på 0.26. vi forkaster altså ikke, at fordelingen af vokaler og konsonanter i vores stikprøver afviger fra afabetet.


Ifølge sproget.dk (https://sproget.dk/temaer/ord-og-bogstaver/hvad-er-de-mest-almindelige-bogstaver-pa-dansk#kilder-kjeld-kristensen-bogstavernes d. 13/9) forekommer bogstaverne e, n, d og r hyppigere end andre bogstaver i alphabetet. 
Lad os derfor gøre tilsvarende som ovenfor for at undersøge om disse forekommer i en frekvens der minder om alfabetet eller, hvis poserne er designet til at man kan stave ord, vil vi forvente disse forekommer oftere end andre bogstaver. 
```{R}
id2 <- ifelse(rownames(Dat_new)%in% c("E","N","D","R"), 
                 TRUE,FALSE)
y_endr <- colSums(Dat_new[id2,])/n

var_endr <- y_endr*(1-y_endr)/(n-1)
sqrt(var_endr) #Standard afvigelse

CI <- cbind(y_endr-uu*sqrt(var_endr),y_endr+uu*sqrt(var_endr))
round(CI,2)
```

Med 4/27 aproksimativt lig 0.15 indeholdt i samtlige konfidensintervaller. Vi kan altså ikke forkaste at e, n, d og r ikke forekommer med samme hyppighed som i alfabetet. 

## Test for uniform fordeling af bogstaverne.
Vi vil nu teste hypotesen, at bogstaverne er uniformt fordelte, dvs. om vi kan antage, at der er nogenlunde det samme antal af hver bogstav i en pose. Vi vil hertil begynde med at betragte et histogram, som viser en fordeling af vores stikprøve. Et barplot summer over antallet af de forskellige bogstaver i \texttt{Dat\_new} og viser således et histogram af de observerede bogstaver.
```{R, echo=FALSE, fig.width=10, fig.height=4.5, fig.cap="\\label{fig:figs} Histogram som viser fordelingen af vores stikprøve. Hver farve indikerer en pose."}
barplot(t(Dat_new[-(28:29),]), col = rainbow(4))
```

Ud fra histogrammet kan vi ikke udelukke en uniform fordeling af bogstaverne. Vi vil nu bruge Kolomogorov-Smirnov testen til at finde en sandsynlighed for, at bogstaverne er uniformt fordelte. Hertil finder vi en vektor, der indeholder tallene fra 1 til 27, som henholdsvis repræsenterer der observerede bogstaver fra \texttt{A} til \texttt{Æ}.
```{R}
Dat_new2 <- Dat_new[-(28:29),]
let <- integer(sum(Dat_new2))
i = 1

for (k in 1:4){
  for (j in 1:27){
    while (Dat_new2[j,k] > 0){
      let[i] = j
      Dat_new2[j,k] = Dat_new2[j,k] - 1
      i = i+1
    }
  }
}

suppressWarnings(ks.test(let, "punif", 1, 27))
```
Sandsynligheden $p = 0.179$ forkaster ikke antagelsen om en uniform fordeling, dog argumenterer den ikke særlig stærk for en uniform fordeling af tallene.\newline
Som nævnt, så er der ingen forskel mellem bogstaverne \texttt{M} og \texttt{W}. Vi vil derfor gentage Kolomogorov-Smirnov testen, hvor vi først lægger antallene af observerede \texttt{M}'er og \texttt{W}'er sammen. I den følgende kodestump bliver \texttt{W} transformeret til \texttt{M}. Derefter kører vi \texttt{ks.test}.
```{R}
for (i in 1:324){
  if (let[i] == 23){
    let[i] <- 13
  }
}

suppressWarnings(ks.test(let, "punif", 1,27))
```
Sandsynligheden $p = 0.4266$ er allerede et meget stærkere argument for en uniform fordeling. Hvis \texttt{M} og \texttt{W} antages at være den samme bogstav, vil vi derfor ikke forkaste hypotesen om en uniform fordeling.
---
title: "Test for ens fordeling i fire poser HARIBO ABC lakrids"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Test for homogenitet
Vi ønsker at teste, om bogstavfordelingen er den samme i de fire poser HARIBO ABC lakrids. Vi opstiller modellen
\begin{equation*}
M_0:X_i=(X_{i1},\ldots,X_{ij},\ldots,X_{i27}) \thicksim m(n_i,\pi)=m(n_i,(\pi_1,\ldots,\pi_{27})),
\end{equation*}
for $i=1,\ldots,4$.

og tester hypotesen
\begin{equation*}
H_1:\pi_1=\dots=\pi_4.
\end{equation*}

$-2lnQ(x)$-teststørrelsen regnes til 
\begin{equation*}
-2lnQ(x)=2*\sum^4_{i=1}\sum^{9}_{j=1}x_{ij}ln(\frac{x_{ij}}{e_{ij}})=18,509.
\end{equation*}
Her er $e_{ij}$ de forventede værdier. Tabeller over disse er vedlagt i Bilag1 og Bilag2. Jævnfør Cochrans regel skal alle de forventede værdier være større eller lig 1, og højst 20% af de forventede værdier må være mindre end 5, før vi kan bruge en $\chi^2$-approximation. I Bilag1 ses de forventede værdier, og vi ser, at de langt fra opfylder Cochrans regel, da ingen af dem er større end 5. Derfor grupperes bogstaverne i grupper af tre, og vi får da 9 grupper istedet for 27. Dette nye data samt de forventede værdier er angivet i Bilag2. Disse forventede værdier opfylder Cochrans regel, da de alle er større end 5.   

Ovenstående teststørrelse giver p-værdien
\begin{equation*}
p_{obs}(x)=1-F_{\chi^2(4-1)(9-1)}(18,509)=0,778.
\end{equation*}
Altså forkastes $H_1$ ikke. Mao. vi kan ikke forkast hypotesen om at de fire poser HARIBO ABC lakridser har samme fordeling af bogstaver. 

## Konklusion

## Bilag1
\begin{center}
\includegraphics[width=8in]{tabeller/ForventedeVardierUdenInddeling.pdf}
\end{center}

## Bilag2
\begin{center}
\includegraphics[width=8in]{tabeller/GruperetDataOgForventedeVardier.pdf}
\end{center}
